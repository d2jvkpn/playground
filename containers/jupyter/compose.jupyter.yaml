services:
  jupyter:
    container_name: jupyter
    image: local/jupyter:cuda12.9-ubuntu24.04
    restart: always
    init: true
    shm_size: 2g
    deploy:
      resources:
        reservations:
          devices:
          - driver: nvidia
            capabilities: [gpu] # Ensure necessary capabilities
            count: all # Or a specific number of GPUs (e.g., 1)
            # device_ids: ["0"]
    network_mode: bridge
    ports: ['0.0.0.0:8888:8888']
    volumes:
    #- ./configs/pip.conf:/home/appuser/.config/pip/pip.conf
    - ./data/bin:/home/appuser/.local/bin
    - ./data/workspace:/home/appuser/workspace
    #- ./data/pip:/home/appuser/.local/lib/python3.11/site-packages
    - ./data/site-packages:/home/appuser/site-packages
    env_file: configs/container.env # set JUPYTER_TOKEN=xxxxxxxx
    environment:
      TZ: Asia/Shanghai
      APPUSER_UID: 1000
      APPUSER_GID: 1000
      #NVIDIA_VISIBLE_DEVICES: "all"
      #NVIDIA_DRIVER_CAPABILITIES: "compute,utility"
    working_dir: /home/appuser/workspace
