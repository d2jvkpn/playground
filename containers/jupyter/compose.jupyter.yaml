services:
  jupyter:
    container_name: jupyter
    #image: local/jupyter:pytorch2.8.0-cuda12.9-cudnn9-runtime
    image: local/jupyter:pytorch:2.9.0-cuda13.0-cudnn9-runtime
    restart: always
    shm_size: 2g
    deploy:
      resources:
        reservations:
          devices:
          - driver: nvidia
            capabilities: [gpu] # Ensure necessary capabilities
            count: all # Or a specific number of GPUs (e.g., 1)
            # device_ids: ["0"]
    network_mode: bridge
    ports: ['0.0.0.0:8888:8888']
    volumes:
    #- ./configs/pip.conf:/home/appuser/.config/pip/pip.conf
    - ./data/bin:/home/appuser/.local/bin
    - ./:/home/appuser/workspace
    #- ./data/pip:/home/appuser/.local/lib/python3.11/site-packages
    - ./data/pip:/home/appuser/.local/lib/python3.12/site-packages
    env_file: configs/container.env # set JUPYTER_TOKEN=xxxxxxxx
    environment:
      TZ: Asia/Shanghai
      USER_UID: 1000
      USER_GID: 1000
      #NVIDIA_VISIBLE_DEVICES: "all"
      #NVIDIA_DRIVER_CAPABILITIES: "compute,utility"
    working_dir: /home/appuser/workspace
