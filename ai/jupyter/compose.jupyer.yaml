
services:
  jupyter:
    container_name: jupyter
    image: cschranz/gpu-jupyter:v1.9_cuda-12.6_ubuntu-24.04
    restart: always
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all # Or a specific number of GPUs (e.g., 1)
              capabilities: [gpu, utility] # Ensure necessary capabilities
              # device_ids: ["0"]  # 使用GPU 0（通过nvidia-smi查看ID）
    network_mode: bridge
    ports: ['8888:8888']
    working_dir: /home/jovyan/work
    volumes:
    - ./volumes/pip.conf:/home/jovyan/.config/pip/pip.conf
    - ./volumes/bash_aliases.sh:/home/jovyan/.bash_aliases
    - ./volumes/ipython_config.py:/home/jovyan/.ipython/profile_default/ipython_config.py
    #- ./data/jupyter/work:/home/jovyan/work
    - ./data/work:/home/jovyan/work
    environment:
      TZ: Asia/Shanghai
      NVIDIA_VISIBLE_DEVICES: "all"
      NVIDIA_DRIVER_CAPABILITIES: "compute,utility"
      PYTHONPATH: /home/jovyan/work/data/pip_packages:/opt/conda/lib/python3.12/site-packages
      JUPYTER_PORT: 8888
      JUPYTER_TOKEN: your_secret_token # Replace with your desired token
