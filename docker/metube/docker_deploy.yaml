version: "3"

services:
  metube:
    image: ghcr.io/alexta69/metube:latest
    container_name: metube-app
    # restart: unless-stopped
    restart: always
    user: ${USER_UID}:${USER_GID}
    networks: ["net"]
    # ports: ["8081:8081"]
    volumes:
    - ./data/metube:/downloads

  caddy:
    image: caddy:2-alpine
    container_name: metube-caddy
    restart: always
    user: ${USER_UID}:${USER_GID}
    # depends_on: ["metube"]
    networks: ["net"]
    ports: ["4042:4042"]
    volumes:
    - ./configs:/app/configs
    - ./logs:/app/logs
    - ./data/caddy/data:/data
    - ./data/caddy/config:/config
    # /etc/caddy/Caddyfile
    command: ["caddy", "run", "--config=/app/configs/caddy.conf", "--adapter=caddyfile"]

networks:
  net: { name: metube, driver: bridge, external: false }
